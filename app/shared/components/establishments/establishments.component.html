<div class="c-cards__header">
  <div class="container">
    <div class="c-cards__headerContent">
      <div class="c-cards__description">
        <h1
          class="c-cards__title">{{'–ó–∞–∫–ª–∞–¥–∏ –≤' | translate}} {{(currentCityNameEn ? currentCityNameEn : cityNameEn) | getLocalizationCityKey | translate}}
        </h1>
        <h2
          class="c-cards__subTitle">{{'–û–±–µ—Ä—ñ—Ç—å –∑–∞–∫–ª–∞–¥, —â–æ–± –ø—Ä–∏–¥–±–∞—Ç–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∏ –Ω–∞ –±—É–¥—å-—è–∫–∏–π —Ç–æ–≤–∞—Ä.' | translate}}</h2>
      </div>
    </div>
  </div>
</div>
<div class="c-cards">
  <div class="container">
    <div class="c-cardsTabs__wrapper">
      <ul *ngIf="isUserLogin" class="c-cardsTabs">
        <li class="c-cardsTabs__item">
          <button class="c-cardsTabs__btn" [class.c-cardsTabs__btn--active]="currentEstablishmentsType === establishmentsType.All"
                  (click)="getCoffeeNetworks(establishmentsType.All)">
            {{'–í—Å—ñ –∑–∞–∫–ª–∞–¥–∏' | translate}}
            <spinner *ngIf="spinnerShown && currentEstablishmentsType === establishmentsType.All && networksLoaded"
                     class="c-cardsTabs__btnSpinner"></spinner>
          </button>
        </li>
        <li class="c-cardsTabs__item">
          <button class="c-cardsTabs__btn" [class.c-cardsTabs__btn--active]="currentEstablishmentsType === establishmentsType.Bonuses"
                  (click)="getCoffeeNetworks(establishmentsType.Bonuses)">
            {{'–ó–∞–∫–ª–∞–¥–∏ –∑ –±–æ–Ω—É—Å–∞–º–∏' | translate}}
            <spinner *ngIf="spinnerShown && currentEstablishmentsType === establishmentsType.Bonuses && networksLoaded"
                     class="c-cardsTabs__btnSpinner"></spinner>
          </button>
        </li>
      </ul>
    </div>
    <ng-container *ngIf="networksLoaded; else networksLoading">
      <ng-container *ngIf="!(notFoundRegion || serverError) && establishments.length; else citiesEmpty">
        <ul class="c-cardsList">
          <li class="c-cardsList__item"
              *ngFor="let establishment of establishments | search:(searchEstablishmentValue$ | async)"
              [ngClass]="{'c-cardsList__item--inaccessible': establishment.inaccessible}"
              (click)="!establishment.inaccessible ? openEstablishment(establishment.slug) : false" addVisitedClass>
            <span *ngIf="establishment.inaccessible" class="c-cardsList__itemType">{{'–ù–µ–∑–∞–±–∞—Ä–æ–º' | translate}}</span>
            <span class="c-cardsList__itemDisclose">
              <span class="c-cardsList__itemDiscloseBtn">
                <img src="/assets/img/icons/icon-more-disclose.svg" alt="">
              </span>
            </span>
            <img defaultImage="/assets/img/img-not-loaded.svg" [lazyLoad]="API_URL + establishment.avatar"
                 [alt]="establishment.name" class="c-cardsList__img">
            <div class="c-cardsList__info">
              <h3 class="c-cardsList__title">{{establishment.name}}</h3>
              <div class="c-cardsList__infoMore">
                <span *ngIf="establishment.percent_bonus > minBonusesPercentage || establishment.bonuses" class="c-cardsList__infoBadge c-cardsList__infoBadge--bonus">
                  <mat-icon>savings</mat-icon>
                  <ng-container *ngIf="establishment.percent_bonus > minBonusesPercentage"> {{establishment.percent_bonus}}%</ng-container>
                  <ng-container *ngIf="establishment.percent_bonus > minBonusesPercentage && establishment.bonuses"> - </ng-container>
                  <ng-container *ngIf="establishment.bonuses && establishment.bonuses.value">{{establishment.bonuses.value}}{{'–≥—Ä–Ω' | translate}}</ng-container>
                </span>
              </div>
            </div>
          </li>
        </ul>
        <div *ngIf="!(establishments | search:(searchEstablishmentValue$ | async)).length" class="c-cards__empty">
          <p class="c-cards__emptyText">
            {{'–ó–∞ –∑–∞–ø–∏—Ç–æ–º' | translate}} <b>"{{searchEstablishmentValue$ | async}}"</b> {{'–Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ' | translate}}
          </p>
        </div>
      </ng-container>
      <ng-template #citiesEmpty>
        <div class="c-cards__empty">
          <ng-container *ngIf="serverError">
            <p class="c-cards__emptyTitle">{{'–£–ø—Å' | translate}}</p>
            <p class="c-cards__emptyText c-cards__emptyText--error">{{serverError | translate}}</p>
          </ng-container>
          <ng-template *ngIf="!spinnerShown; else networksLoading" [ngTemplateOutlet]="this[currentEstablishmentsType]"></ng-template>
        </div>
      </ng-template>
    </ng-container>
  </div>
</div>
<search-input *ngIf="networksLoaded" [isFixed]="true" [placeholder]="'–ó–Ω–∞–π—Ç–∏ –∑–∞–∫–ª–∞–¥'"></search-input>
<scroll-top [nearSearch]="true"></scroll-top>

<ng-template #networksLoading>
  <spinner class="c-cards__spinner"></spinner>
</ng-template>

<ng-template #all>
  <p class="c-cards__emptyTitle">{{'–ó–∞–∫–ª–∞–¥—ñ–≤ –Ω–µ–º–∞—î' | translate}}</p>
  <ng-container *ngIf="!notFoundRegion; else regionDoesntExist">
    <p class="c-cards__emptyText">{{'–ó–∞–∫–ª–∞–¥—ñ–≤ –≤ —Ç–∞–∫–æ–º—É –º—ñ—Å—Ç—ñ —â–µ –Ω–µ–º–∞—î.' | translate}} üòû</p>
  </ng-container>
  <ng-template #regionDoesntExist>
    <p class="c-cards__emptyText">{{'–¢–∞–∫–æ–≥–æ –º—ñ—Å—Ç–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –∞–±–æ —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫.' | translate}} üòû</p>
  </ng-template>
  <button class="o-button o-button--secondary" (click)="openCitiesDialog()">
    {{'–í–∏–±—Ä–∞—Ç–∏ —ñ–Ω—à–µ –º—ñ—Å—Ç–æ' | translate}}
  </button>
</ng-template>
<ng-template #bonuses>
  <p class="c-cards__emptyTitle">
    {{'–í–∏ –Ω–µ –º–∞—î—Ç–µ –∑–∞–∫–ª–∞–¥—ñ–≤ –∑ –±–æ–Ω—É—Å–∞–º–∏ –≤ –º—ñ—Å—Ç—ñ' | translate}} {{currentCityNameEn | getLocalizationCityKey | translate}}
  </p>
  <p class="c-cards__emptyText">
    {{'–®–æ–± –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –±–æ–Ω—É—Å–∏, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—è —ñ –∑—Ä–æ–±—ñ—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ –∑–∞–∫–ª–∞–¥—ñ, —è–∫–∏–π —Ä–µ–∞–ª—ñ–∑—É—î –±–æ–Ω—É—Å–Ω—É —Å–∏—Å—Ç–µ–º—É.' | translate}}
  </p>
</ng-template>
<ng-template #selected>
  <p class="c-cards__emptyTitle">
    {{'–í–∏ –Ω–µ –º–∞—î–µ—Ç–µ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∑–∞–∫–ª–∞–¥—ñ–≤ –≤ –º—ñ—Å—Ç—ñ' | translate}} {{currentCityNameEn | getLocalizationCityKey | translate}}
  </p>
  <p class="c-cards__emptyText">
    {{'–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–æ –≤ –∫–∞—Ä—Ç–æ—á—Ü—ñ –∑–∞–∫–ª–∞–¥—É, —â–æ–± –¥–æ–¥–∞—Ç–∏ –π–æ–≥–æ –¥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö.' | translate}}
  </p>
</ng-template>
